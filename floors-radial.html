<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Floors — Radial Year View · 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg:        #080b12;
    --ring:      #0f1420;
    --border:    #1a2236;
    --climbed:   #e8c97a;
    --descended: #7db8e0;
    --c-glow:    rgba(232,201,122,0.15);
    --d-glow:    rgba(125,184,224,0.15);
    --text:      #ddd8cc;
    --muted:     #4a5570;
    --dim:       #252e42;
    --accent:    #c0964e;
  }

  html, body {
    width: 100%; height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    overflow-x: hidden;
  }

  /* Starfield background */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image:
      radial-gradient(1px 1px at 15% 20%, rgba(255,255,255,0.18) 0%, transparent 100%),
      radial-gradient(1px 1px at 72% 8%,  rgba(255,255,255,0.12) 0%, transparent 100%),
      radial-gradient(1px 1px at 40% 65%, rgba(255,255,255,0.10) 0%, transparent 100%),
      radial-gradient(1px 1px at 88% 50%, rgba(255,255,255,0.14) 0%, transparent 100%),
      radial-gradient(1px 1px at 5%  80%, rgba(255,255,255,0.09) 0%, transparent 100%),
      radial-gradient(1px 1px at 60% 90%, rgba(255,255,255,0.11) 0%, transparent 100%),
      radial-gradient(1px 1px at 25% 45%, rgba(255,255,255,0.08) 0%, transparent 100%),
      radial-gradient(1px 1px at 95% 30%, rgba(255,255,255,0.13) 0%, transparent 100%),
      radial-gradient(600px 600px at 50% 50%, rgba(20,32,64,0.5) 0%, transparent 70%);
    pointer-events: none; z-index: 0;
  }

  .page {
    position: relative; z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 32px 20px 40px;
    min-height: 100vh;
  }

  /* Header */
  header {
    width: 100%;
    max-width: 760px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 28px;
  }

  .h-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(20px, 3vw, 30px);
    font-weight: 400;
    letter-spacing: -0.01em;
    line-height: 1.15;
  }

  .h-title span { color: var(--climbed); font-style: italic; }

  .h-sub {
    font-size: 9px;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 5px;
  }

  .h-legend {
    display: flex; flex-direction: column; gap: 7px; align-items: flex-end;
  }

  .legend-row {
    display: flex; align-items: center; gap: 8px;
    font-size: 9px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted);
  }

  .leg-bar {
    width: 22px; height: 7px; border-radius: 1px;
  }

  /* Stats strip */
  .stats-strip {
    display: flex; gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 28px;
    width: 100%;
    max-width: 760px;
  }

  .stat {
    flex: 1;
    background: #0c101a;
    padding: 12px 16px;
  }

  .stat-l { font-size: 8px; letter-spacing: 0.22em; text-transform: uppercase; color: var(--muted); margin-bottom: 4px; }
  .stat-v { font-size: 20px; font-weight: 500; letter-spacing: -0.03em; font-variant-numeric: tabular-nums; }
  .stat-v.gold  { color: var(--climbed); }
  .stat-v.blue  { color: var(--descended); }
  .stat-v.white { color: var(--text); }

  /* Chart container */
  #chart { position: relative; cursor: crosshair; }

  /* Center info panel */
  #center-info {
    position: absolute;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    transition: opacity 0.2s;
  }

  .ci-week {
    font-size: 8px; letter-spacing: 0.25em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 10px;
  }

  .ci-values {
    display: flex; gap: 18px; align-items: flex-end;
    margin-bottom: 10px;
  }

  .ci-val {
    display: flex; flex-direction: column; align-items: center; gap: 3px;
  }

  .ci-num {
    font-family: 'Libre Baskerville', serif;
    font-size: 28px; font-weight: 700;
    letter-spacing: -0.03em;
    line-height: 1;
  }

  .ci-num.gold  { color: var(--climbed); }
  .ci-num.blue  { color: var(--descended); }

  .ci-lbl { font-size: 7px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }

  .ci-divider {
    width: 1px; height: 32px; background: var(--border); align-self: center;
  }

  .ci-net {
    font-size: 9px; letter-spacing: 0.1em; color: var(--muted);
    padding-top: 8px; border-top: 1px solid var(--border);
    width: 100%;
    text-align: center;
  }

  .ci-idle {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(11px, 1.8vw, 16px);
    font-style: italic;
    color: var(--muted);
    line-height: 1.6;
    text-align: center;
  }

  .ci-idle strong {
    display: block;
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(22px, 3.5vw, 36px);
    font-style: normal;
    color: var(--text);
    letter-spacing: -0.03em;
    margin-bottom: 2px;
  }

  .ci-idle em {
    font-size: clamp(8px, 1.2vw, 10px);
    font-style: normal;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
  }

  /* SVG styles */
  .ref-ring { fill: none; stroke: var(--dim); stroke-width: 0.5; }
  .ref-ring-2 { fill: none; stroke: var(--border); stroke-width: 0.5; }
  .axis-ring { fill: none; stroke: var(--muted); stroke-width: 1; opacity: 0.4; }
  .tick-mark { stroke: var(--muted); stroke-width: 0.8; opacity: 0.3; }
  .month-sep { stroke: var(--border); stroke-width: 1; stroke-dasharray: 3 4; }
  .month-label {
    font-family: 'DM Mono', monospace;
    font-size: 9.5px; fill: var(--muted);
    letter-spacing: 0.12em; text-transform: uppercase;
  }
  .ref-label {
    font-family: 'DM Mono', monospace;
    font-size: 7.5px; fill: var(--muted);
    letter-spacing: 0.08em; opacity: 0.7;
  }
  .week-arc-climbed {
    fill: var(--climbed);
    opacity: 0.85;
    transition: opacity 0.12s, filter 0.12s;
  }
  .week-arc-descended {
    fill: var(--descended);
    opacity: 0.8;
    transition: opacity 0.12s, filter 0.12s;
  }
  .week-arc-climbed:hover,
  .week-arc-descended:hover {
    opacity: 1;
    filter: drop-shadow(0 0 6px var(--climbed));
  }
  .week-arc-descended:hover {
    filter: drop-shadow(0 0 6px var(--descended));
  }
  .week-group.dimmed .week-arc-climbed,
  .week-group.dimmed .week-arc-descended {
    opacity: 0.18;
  }

  footer {
    margin-top: 24px;
    font-size: 8px; letter-spacing: 0.18em; text-transform: uppercase;
    color: var(--dim);
    display: flex; gap: 24px;
  }
</style>
</head>
<body>
<div class="page">

  <header>
    <div>
      <div class="h-title">Floors <span>Climbed</span> & Descended</div>
      <div class="h-sub">52-week radial view · 2025</div>
    </div>
    <div class="h-legend">
      <div class="legend-row">
        <div class="leg-bar" style="background:var(--climbed);"></div>
        Climbed → outward
      </div>
      <div class="legend-row">
        <div class="leg-bar" style="background:var(--descended);"></div>
        Descended → inward
      </div>
    </div>
  </header>

  <div class="stats-strip" id="stats-strip"></div>

  <div id="chart">
    <div id="center-info"></div>
  </div>

  <footer>
    <span>Hover a week to inspect</span>
    <span>Jan – Dec 2025 · 52 weeks</span>
  </footer>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
/* ── Data ───────────────────────────────────────────────── */
const raw = [
  ["01/02/2025",347,320],["01/09/2025",191,198],["01/16/2025",125,139],
  ["01/23/2025",180,170],["01/30/2025",161,166],["02/06/2025",207,223],
  ["02/13/2025",173,177],["02/20/2025",113,91], ["02/27/2025",76,50],
  ["03/06/2025",286,309],["03/13/2025",150,169],["03/20/2025",83,80],
  ["03/27/2025",56,53],  ["04/03/2025",51,76],  ["04/10/2025",53,42],
  ["04/17/2025",74,88],  ["04/24/2025",85,97],  ["05/01/2025",106,92],
  ["05/08/2025",165,137],["05/15/2025",145,126],["05/22/2025",172,180],
  ["05/29/2025",72,70],  ["06/05/2025",92,86],  ["06/12/2025",64,48],
  ["06/19/2025",80,65],  ["06/26/2025",69,67],  ["07/03/2025",153,109],
  ["07/10/2025",76,68],  ["07/17/2025",88,90],  ["07/24/2025",70,65],
  ["07/31/2025",158,134],["08/07/2025",111,90], ["08/14/2025",95,74],
  ["08/21/2025",126,68], ["08/28/2025",84,49],  ["09/04/2025",70,44],
  ["09/11/2025",89,78],  ["09/18/2025",153,147],["09/25/2025",127,121],
  ["10/02/2025",294,295],["10/09/2025",261,239],["10/16/2025",72,68],
  ["10/23/2025",93,54],  ["10/30/2025",49,42],  ["11/06/2025",87,81],
  ["11/13/2025",90,85],  ["11/20/2025",108,108],["11/27/2025",284,262],
  ["12/04/2025",119,111],["12/11/2025",133,122],["12/18/2025",352,364],
  ["12/25/2025",271,252]
];

const parseDate = d3.timeParse("%m/%d/%Y");
const fmtShort  = d3.timeFormat("%b %d");
const fmtMon    = d3.timeFormat("%b");

const data = raw.map(([w, c, d]) => ({
  week: parseDate(w),
  climbed: c,
  descended: d,
  diff: c - d
}));

/* ── Stats strip ────────────────────────────────────────── */
const totalC = d3.sum(data, d => d.climbed);
const totalD = d3.sum(data, d => d.descended);
const peakW  = data.reduce((a,b) => b.climbed > a.climbed ? b : a);
const avgC   = Math.round(d3.mean(data, d => d.climbed));
const netAll = totalC - totalD;

document.getElementById('stats-strip').innerHTML = `
  <div class="stat"><div class="stat-l">Total Climbed</div><div class="stat-v gold">${totalC.toLocaleString()}</div></div>
  <div class="stat"><div class="stat-l">Total Descended</div><div class="stat-v blue">${totalD.toLocaleString()}</div></div>
  <div class="stat"><div class="stat-l">Net Floors</div><div class="stat-v ${netAll>=0?'gold':'blue'}">${netAll>0?'+':''}${netAll.toLocaleString()}</div></div>
  <div class="stat"><div class="stat-l">Peak Week</div><div class="stat-v white">${peakW.climbed} <span style="font-size:11px;color:var(--muted)">${fmtShort(peakW.week)}</span></div></div>
  <div class="stat"><div class="stat-l">Weekly Avg</div><div class="stat-v white">${avgC}</div></div>
`;

/* ── Geometry ───────────────────────────────────────────── */
const N = data.length;                  // 52
const TWO_PI = 2 * Math.PI;
const GAP_FRAC = 0.18;                  // gap between arcs

// Responsive sizing
function getSize() {
  const vw = Math.min(window.innerWidth - 40, 760);
  const size = Math.min(vw, window.innerHeight * 0.72);
  return Math.max(size, 340);
}

const MAX_C  = d3.max(data, d => d.climbed);
const MAX_D  = d3.max(data, d => d.descended);

// Month groupings for separators
const months = [];
let curMonth = null, curStart = null;
data.forEach((d, i) => {
  const m = d.week.getMonth();
  if (m !== curMonth) {
    if (curMonth !== null) months.push({ month: curMonth, startIdx: curStart, endIdx: i - 1 });
    curMonth = m; curStart = i;
  }
});
months.push({ month: curMonth, startIdx: curStart, endIdx: N - 1 });

/* ── Build SVG ──────────────────────────────────────────── */
let activeIdx = null;

function build() {
  const chartDiv = document.getElementById('chart');
  chartDiv.querySelectorAll('svg').forEach(e => e.remove());

  const S = getSize();
  const cx = S / 2, cy = S / 2;

  // Radii
  const BASE_R  = S * 0.285;   // axis ring
  const MAX_OUT = S * 0.295;   // max bar outward (climbed)
  const MAX_IN  = S * 0.175;   // max bar inward  (descended)
  const REF_OUT = S * 0.305;   // outer decorative ring
  const LABEL_R = S * 0.328;   // month labels

  chartDiv.style.width  = S + 'px';
  chartDiv.style.height = S + 'px';

  // Position center info
  const ci = document.getElementById('center-info');
  const ciW = BASE_R * 1.2;
  ci.style.width  = ciW + 'px';
  ci.style.height = ciW + 'px';
  ci.style.left   = (cx - ciW / 2) + 'px';
  ci.style.top    = (cy - ciW / 2) + 'px';

  showIdleCenter();

  const svg = d3.select('#chart').append('svg')
    .attr('width', S).attr('height', S)
    .style('position', 'absolute').style('top', 0).style('left', 0);

  const defs = svg.append('defs');

  // Glow filters
  ['climbed','descended'].forEach(k => {
    const f = defs.append('filter').attr('id', `glow-${k}`).attr('x','-30%').attr('y','-30%').attr('width','160%').attr('height','160%');
    f.append('feGaussianBlur').attr('stdDeviation', 3).attr('result', 'blur');
    f.append('feComposite').attr('in','SourceGraphic').attr('in2','blur').attr('operator','over');
  });

  // Gradient: climbed bars
  const gcUp = defs.append('radialGradient').attr('id','gc-up')
    .attr('cx','50%').attr('cy','50%').attr('r','50%')
    .attr('gradientUnits','userSpaceOnUse')
    .attr('cx', cx).attr('cy', cy).attr('r', BASE_R + MAX_OUT);
  gcUp.append('stop').attr('offset','0%').attr('stop-color','#c0964e').attr('stop-opacity',0.9);
  gcUp.append('stop').attr('offset','100%').attr('stop-color','#f0d990').attr('stop-opacity',1);

  // Gradient: descended bars
  const gcDn = defs.append('radialGradient').attr('id','gc-dn')
    .attr('cx', cx).attr('cy', cy).attr('r', BASE_R)
    .attr('gradientUnits','userSpaceOnUse');
  gcDn.append('stop').attr('offset','0%').attr('stop-color','#4a90c8').attr('stop-opacity',1);
  gcDn.append('stop').attr('offset','100%').attr('stop-color','#a8d4f0').attr('stop-opacity',0.9);

  const g = svg.append('g').attr('transform', `translate(${cx},${cy})`);

  /* ── Reference rings ── */
  // Inner rings for descended scale
  [0.33, 0.66, 1].forEach((t, i) => {
    const r = BASE_R - MAX_IN * t;
    g.append('circle').attr('r', r)
      .attr('class', i === 2 ? 'ref-ring' : 'ref-ring')
      .attr('stroke', i === 2 ? '#1a2236' : '#11172a')
      .attr('stroke-width', i === 2 ? 0.8 : 0.4)
      .attr('fill', 'none');
  });

  // Outer rings for climbed scale
  [0.33, 0.66, 1].forEach((t, i) => {
    const r = BASE_R + MAX_OUT * t;
    g.append('circle').attr('r', r)
      .attr('fill', 'none')
      .attr('stroke', i === 2 ? '#1a2236' : '#11172a')
      .attr('stroke-width', i === 2 ? 0.8 : 0.4);

    // Scale label at ~top
    if (i < 2) {
      const labelAngle = -Math.PI / 2 + 0.06;
      const lx = Math.cos(labelAngle) * r;
      const ly = Math.sin(labelAngle) * r;
      g.append('text').attr('class','ref-label')
        .attr('x', lx).attr('y', ly)
        .attr('text-anchor','middle').attr('dominant-baseline','middle')
        .text(Math.round(MAX_C * (t)));
    }
  });

  // Outer decorative ring
  g.append('circle').attr('r', REF_OUT)
    .attr('fill', 'none')
    .attr('stroke', '#1e2a40')
    .attr('stroke-width', 1.2);

  // Axis ring
  g.append('circle').attr('r', BASE_R)
    .attr('class', 'axis-ring');

  /* ── Week tick marks on axis ring ── */
  data.forEach((_, i) => {
    const a = (i / N) * TWO_PI - Math.PI / 2;
    const r0 = BASE_R - 4, r1 = BASE_R + 4;
    g.append('line')
      .attr('class','tick-mark')
      .attr('x1', Math.cos(a)*r0).attr('y1', Math.sin(a)*r0)
      .attr('x2', Math.cos(a)*r1).attr('y2', Math.sin(a)*r1);
  });

  /* ── Month separators & labels ── */
  months.forEach(({ month, startIdx }) => {
    const a = (startIdx / N) * TWO_PI - Math.PI / 2;
    const r0 = BASE_R - MAX_IN - 6;
    const r1 = REF_OUT + 18;
    g.append('line')
      .attr('class','month-sep')
      .attr('x1', Math.cos(a)*r0).attr('y1', Math.sin(a)*r0)
      .attr('x2', Math.cos(a)*r1).attr('y2', Math.sin(a)*r1);

    // Month label at midpoint of that month's arc
    const mData = months.find(m => m.month === month);
    const midIdx = (mData.startIdx + mData.endIdx) / 2;
    const la = (midIdx / N) * TWO_PI - Math.PI / 2;
    const lx = Math.cos(la) * LABEL_R;
    const ly = Math.sin(la) * LABEL_R;
    const deg = (la * 180 / Math.PI) + 90;
    const flip = (deg > 90 && deg < 270) ? 180 : 0;

    g.append('text')
      .attr('class','month-label')
      .attr('x', lx).attr('y', ly)
      .attr('text-anchor','middle')
      .attr('dominant-baseline','middle')
      .attr('transform', `rotate(${deg + flip},${lx},${ly})`)
      .text(['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][month]);
  });

  /* ── Compass cross-hairs (faint) ── */
  [-90,-45,0,45,90,135,180,225].forEach(deg => {
    const rad = deg * Math.PI / 180;
    const r0 = BASE_R - MAX_IN;
    const r1 = BASE_R + MAX_OUT;
    g.append('line')
      .attr('x1', Math.cos(rad)*r0).attr('y1', Math.sin(rad)*r0)
      .attr('x2', Math.cos(rad)*r1).attr('y2', Math.sin(rad)*r1)
      .attr('stroke','#131a28').attr('stroke-width', deg % 90 === 0 ? 0.8 : 0.4);
  });

  /* ── Arc generator ── */
  const arc = d3.arc();

  const anglePerWeek = TWO_PI / N;
  const barAngle = anglePerWeek * (1 - GAP_FRAC);

  /* ── Draw bars ── */
  const groups = g.selectAll('.week-group')
    .data(data)
    .enter().append('g')
    .attr('class','week-group');

  // Climbed (outward)
  groups.append('path')
    .attr('class','week-arc-climbed')
    .attr('fill', 'url(#gc-up)')
    .attr('d', (d, i) => {
      const startA = (i / N) * TWO_PI - Math.PI/2 + anglePerWeek * GAP_FRAC / 2;
      const endA   = startA + barAngle;
      const len = (d.climbed / MAX_C) * MAX_OUT;
      return arc({
        innerRadius: BASE_R + 1,
        outerRadius: BASE_R + Math.max(2, len),
        startAngle: startA,
        endAngle: endA
      });
    })
    .attr('opacity', 0)
    .transition()
    .delay((_, i) => i * 14)
    .duration(420)
    .ease(d3.easeCubicOut)
    .attr('opacity', 0.85);

  // Descended (inward)
  groups.append('path')
    .attr('class','week-arc-descended')
    .attr('fill','url(#gc-dn)')
    .attr('d', (d, i) => {
      const startA = (i / N) * TWO_PI - Math.PI/2 + anglePerWeek * GAP_FRAC / 2;
      const endA   = startA + barAngle;
      const len = (d.descended / MAX_D) * MAX_IN;
      return arc({
        innerRadius: BASE_R - Math.max(2, len),
        outerRadius: BASE_R - 1,
        startAngle: startA,
        endAngle: endA
      });
    })
    .attr('opacity', 0)
    .transition()
    .delay((_, i) => i * 14 + 100)
    .duration(420)
    .ease(d3.easeCubicOut)
    .attr('opacity', 0.8);

  /* ── Invisible hover targets ── */
  groups.append('path')
    .attr('d', (d, i) => {
      const startA = (i / N) * TWO_PI - Math.PI/2 + anglePerWeek * GAP_FRAC / 2;
      const endA   = startA + barAngle;
      return arc({
        innerRadius: BASE_R - MAX_IN,
        outerRadius: BASE_R + MAX_OUT,
        startAngle: startA,
        endAngle: endA
      });
    })
    .attr('fill','transparent')
    .style('cursor','pointer')
    .on('mouseenter', function(_, d) {
      const i = data.indexOf(d);
      activeIdx = i;
      groups.classed('dimmed', (_, j) => j !== i);
      showWeekCenter(d);
    })
    .on('mouseleave', function() {
      activeIdx = null;
      groups.classed('dimmed', false);
      showIdleCenter();
    });

  /* ── Center decoration dots ── */
  [0,60,120,180,240,300].forEach(deg => {
    const r = deg % 120 === 0 ? 5 : 3;
    const rad = deg * Math.PI / 180;
    g.append('circle')
      .attr('cx', Math.cos(rad) * (BASE_R * 0.18))
      .attr('cy', Math.sin(rad) * (BASE_R * 0.18))
      .attr('r', r * 0.35)
      .attr('fill','var(--dim)');
  });
}

function showIdleCenter() {
  document.getElementById('center-info').innerHTML = `
    <div class="ci-idle">
      <strong>${totalC.toLocaleString()}</strong>
      <span>floors climbed</span><br>
      <em style="margin-top:6px;display:block">2025 · 52 weeks</em>
    </div>`;
}

const fmtWeek = d3.timeFormat("%-m/%-d/%Y");

function showWeekCenter(d) {
  const sign = d.diff >= 0 ? '+' : '';
  const col  = d.diff >= 0 ? 'gold' : 'blue';
  document.getElementById('center-info').innerHTML = `
    <div class="ci-week">${fmtShort(d.week)}</div>
    <div class="ci-values">
      <div class="ci-val">
        <div class="ci-num gold">${d.climbed}</div>
        <div class="ci-lbl">Climbed</div>
      </div>
      <div class="ci-divider"></div>
      <div class="ci-val">
        <div class="ci-num blue">${d.descended}</div>
        <div class="ci-lbl">Descended</div>
      </div>
    </div>
    <div class="ci-net">Net <span style="color:var(--${col})">${sign}${d.diff}</span> floors</div>`;
}

build();
window.addEventListener('resize', () => { build(); });
</script>
</body>
</html>
